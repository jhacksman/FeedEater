{
  "name": "telegram",
  "version": "0.0.1",
  "namespace": "feedeater.telegram",
  "runtime": { "entry": "dist/runtime.js" },
  "queues": ["mod_telegram"],
  "jobs": [
    {
      "name": "collect",
      "queue": "mod_telegram",
      "schedule": "*/5 * * * *",
      "description": "Collect Telegram messages from user's dialogs and persist raw extracts into mod_telegram."
    },
    {
      "name": "updateContexts",
      "queue": "mod_telegram",
      "schedule": "*/30 * * * *",
      "description": "Refresh context summaries from recent Telegram messages."
    }
  ],
  "settings": [
    { "key": "enabled", "type": "boolean", "default": false },
    { "key": "apiId", "type": "number", "required": true, "description": "Telegram API ID from my.telegram.org" },
    { "key": "apiHash", "type": "secret", "required": true, "description": "Telegram API hash from my.telegram.org" },
    { "key": "sessionString", "type": "secret", "required": true, "description": "MTProto session string (generated during auth)" },
    { "key": "lookbackHours", "type": "number", "default": 168, "description": "Hours of history to fetch on first run (default 7 days)" },
    { "key": "collectDialogTypes", "type": "string", "default": "[\"channel\",\"supergroup\",\"group\",\"private\"]", "description": "JSON array of dialog types to collect" },
    { "key": "excludeArchived", "type": "boolean", "default": true, "description": "Skip archived chats" },
    { "key": "collectSavedMessages", "type": "boolean", "default": true, "description": "Include Saved Messages" },
    { "key": "includeDialogIds", "type": "string", "default": "[]", "description": "JSON array of dialog IDs to collect (empty = all)" },
    { "key": "excludeDialogIds", "type": "string", "default": "[]", "description": "JSON array of dialog IDs to never collect" },
    { "key": "minMessageLength", "type": "number", "default": 0, "description": "Skip messages shorter than this" },
    { "key": "floodWaitMultiplier", "type": "number", "default": 1.5, "description": "Safety multiplier for FLOOD_WAIT durations" },
    {
      "key": "contextPrompt",
      "type": "string",
      "default": "You are summarizing the provided Telegram messages. Summarize ONLY the messages provided. Do not make suggestions, ask questions, or add commentary. Return strict JSON with keys: summary_short and summary_long. summary_short must be <= 128 characters. summary_long should be 1-3 short paragraphs. Do not return empty strings."
    },
    {
      "key": "contextPromptFallback",
      "type": "string",
      "default": "Summarize ONLY the provided messages in plain text. 1-3 short sentences. Do not return JSON. Do not make suggestions or ask questions."
    }
  ],
  "cards": [
    { "id": "telegramStatus", "title": "Telegram Collector" },
    { "id": "telegramDialogs", "title": "Telegram Dialogs" }
  ]
}
